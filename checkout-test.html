<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nima Schmuck - Checkout Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
      }
      .product {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
      }
      .product img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
      }
      button {
        background: #635bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background: #5a4fd8;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .cart {
        background: #f8f9ff;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .total {
        font-weight: bold;
        font-size: 20px;
        color: #333;
      }
      #status {
        margin: 20px 0;
        padding: 10px;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <h1>üõçÔ∏è Nima Schmuck Checkout Test</h1>

    <!-- Product Catalog (simulates your products) -->
    <div id="products">
      <div class="product" onclick="addToCart(0)">
        <img
          src="./project-25-2-scrum-team-2/backend/public/images/img13.webp"
          alt="SteelFlex"
        />
        <h3>SteelFlex Armband</h3>
        <p>Premium stainless steel bracelet</p>
        <strong>‚Ç¨29.99</strong>
      </div>

      <div class="product" onclick="addToCart(1)">
        <img
          src="./project-25-2-scrum-team-2/backend/public/images/img13.webp"
          alt="PowerGrip"
        />
        <h3>PowerGrip Kette</h3>
        <p>Heavy-duty chain necklace</p>
        <strong>‚Ç¨49.99</strong>
      </div>

      <div class="product" onclick="addToCart(2)">
        <img
          src="./project-25-2-scrum-team-2/backend/public/images/img13.webp"
          alt="Diamant"
        />
        <h3>Diamant Ring</h3>
        <p>Swarovski crystal ring</p>
        <strong>‚Ç¨19.99</strong>
      </div>
    </div>

    <!-- Shopping Cart -->
    <div id="cart" class="cart" style="display: none">
      <h3>üõí Your Cart</h3>
      <div id="cart-items"></div>
      <div class="total">Total: ‚Ç¨<span id="cart-total">0.00</span></div>
      <br />
      <button id="checkout-btn" onclick="startCheckout()" disabled>
        üí≥ Proceed to Checkout
      </button>
    </div>

    <!-- Status Messages -->
    <div id="status"></div>

    <script>
      // Sample product data (replace with your real API data)
      const products = [
        {
          id: 1,
          name: "SteelFlex Armband",
          price: 29.99,
          image: "./project-25-2-scrum-team-2/backend/public/images/img13.webp",
        },
        {
          id: 2,
          name: "PowerGrip Kette",
          price: 49.99,
          image: "./project-25-2-scrum-team-2/backend/public/images/img13.webp",
        },
        {
          id: 3,
          name: "Diamant Ring",
          price: 19.99,
          image: "./project-25-2-scrum-team-2/backend/public/images/img13.webp",
        },
      ];

      let cart = [];

      // Add product to cart
      function addToCart(productIndex) {
        const product = products[productIndex];
        const existing = cart.find((item) => item.id === product.id);

        if (existing) {
          existing.quantity += 1;
        } else {
          cart.push({ ...product, quantity: 1 });
        }

        updateCart();
        showStatus("Product added to cart!", "success");
      }

      // Update cart display
      function updateCart() {
        const cartEl = document.getElementById("cart");
        const cartItemsEl = document.getElementById("cart-items");
        const totalEl = document.getElementById("cart-total");
        const checkoutBtn = document.getElementById("checkout-btn");

        if (cart.length === 0) {
          cartEl.style.display = "none";
          return;
        }

        cartEl.style.display = "block";

        cartItemsEl.innerHTML = cart
          .map(
            (item) => `
        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
          <span>${item.name} √ó ${item.quantity}</span>
          <span>‚Ç¨${(item.price * item.quantity).toFixed(2)}</span>
        </div>
      `
          )
          .join("");

        const total = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );
        totalEl.textContent = total.toFixed(2);
        checkoutBtn.disabled = false;
      }

      // Start Stripe Checkout
      async function startCheckout() {
        const checkoutBtn = document.getElementById("checkout-btn");
        checkoutBtn.disabled = true;
        checkoutBtn.textContent = "Creating payment...";

        try {
          const response = await fetch(
            "https://project-25-2-scrum-team-2.onrender.com/api/checkout/create-session",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                line_items: cart.map((item) => ({
                  name: item.name,
                  price: item.price,
                  quantity: item.quantity,
                  images: [item.image],
                })),
                success_url:
                  "https://project-25-2-scrum-team-2.onrender.com/success?session_id={CHECKOUT_SESSION_ID}",
                cancel_url: "https://project-25-2-scrum-team-2.onrender.com/checkout-test.html",
              }),
            }
          );

          const data = await response.json();

          if (data.url) {
            // Redirect to Stripe Checkout
            window.location.href = data.url;
          } else {
            throw new Error(data.error || "No payment URL received");
          }
        } catch (error) {
          showStatus("Checkout failed: " + error.message, "error");
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = "üí≥ Proceed to Checkout";
        }
      }

      // Show status message
      function showStatus(message, type) {
        const statusEl = document.getElementById("status");
        statusEl.textContent = message;
        statusEl.className = type;
        setTimeout(() => {
          statusEl.textContent = "";
          statusEl.className = "";
        }, 5000);
      }
    </script>
  </body>
</html>
